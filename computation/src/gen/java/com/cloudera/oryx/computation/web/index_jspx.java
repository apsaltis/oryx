/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspCServletContext/1.0
 * Generated at: 2013-11-08 13:13:44 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package com.cloudera.oryx.computation.web;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.cloudera.oryx.computation.PeriodicRunner;
import com.cloudera.oryx.computation.common.GenerationRunnerState;
import com.cloudera.oryx.computation.common.StepState;
import com.cloudera.oryx.computation.common.StepStatus;
import com.cloudera.oryx.computation.PeriodicRunnerState;
import com.cloudera.oryx.computation.web.ComputationInitListener;
import java.text.DateFormat;
import java.text.NumberFormat;
import java.util.Date;

public final class index_jspx extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {


private static String formatShort(Date date) {
  return date == null ? "" : DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.SHORT).format(date);
}
private static String formatPercent(float pct) {
  return Float.isNaN(pct) ? "0%" : NumberFormat.getPercentInstance().format(pct);
}
private static String getHexColor(StepStatus status) {
  switch (status) {
    case COMPLETED:
      return "green";
    case FAILED:
      return "red";
    case CANCELLED:
      return "yellow";
    default:
      return "white";
  }
}

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, false, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("<!DOCTYPE html>");
      out.write("<html>");
      out.write("<head>");
      out.write("<title>");
      out.write("Oryx Computation Layer");
      out.write("</title>");
      out.write("<link href=\"/style.jspx\" type=\"text/css\" rel=\"stylesheet\"/>");
      out.write("<script type=\"text/javascript\">");
      out.write("\nfunction confirmAndPost(formName) {\n  if (confirm(\"Are you sure?\")) {\n    document.forms[formName].submit();\n    return true;\n  } else {\n    return false;\n  }\n}\n");
      out.write("</script>");
      out.write("</head>");
      out.write("<body>");
      out.write("<div style=\"width:800px;margin-left:auto;margin-right:auto;padding:10px\">");
      out.write("<h1>");
      out.write("Oryx Computation Layer");
      out.write("</h1>");
      out.write("<h2>");
      out.write("Generations");
      out.write("</h2>");
      out.write("<table style=\"width:100%\">");
      out.write("<tr>");
      out.write("<th>");
      out.write("Name");
      out.write("</th>");
      out.write("<th>");
      out.write("Status");
      out.write("</th>");
      out.write("<th>");
      out.write("Start");
      out.write("</th>");
      out.write("<th style=\"width:50px\">");
      out.write("Map %");
      out.write("</th>");
      out.write("<th style=\"width:50px\">");
      out.write("Reduce %");
      out.write("</th>");
      out.write("<th>");
      out.write('E');
      out.write('n');
      out.write('d');
      out.write("</th>");
      out.write("</tr>");

  PeriodicRunner periodicRunner = (PeriodicRunner) application.getAttribute(ComputationInitListener.PERIODIC_RUNNER_KEY);
  pageContext.setAttribute("periodicRunner", periodicRunner);
    PeriodicRunnerState periodicRunnerState = periodicRunner.getState();
    if (!periodicRunnerState.isRunning()) {
      Date nextScheduledRun = periodicRunnerState.getNextScheduledRun();
      pageContext.setAttribute("nextScheduledRun",
                               nextScheduledRun == null ? "" : formatShort(nextScheduledRun));
      pageContext.setAttribute("currentGenerationMB", periodicRunnerState.getCurrentGenerationMB());
  
      out.write("<tr>");
      out.write("<td style=\"background-color:black;text-align:left\" colspan=\"2\">");
      out.write("<span style=\"font-style:italic\">");
      out.write("Next Generation (");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${currentGenerationMB}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(" MB written)");
      out.write("</span>");
      out.write("\n      &middot;\n      ");
      out.write("<form style=\"display:inline\" method=\"POST\" action=\"/periodicRunner/forceRun\" name=\"periodicRunnerForceRun\">");
      out.write("<a href=\"javascript:confirmAndPost('periodicRunnerForceRun')\">");
      out.write("Force Run");
      out.write("</a>");
      out.write("</form>");
      out.write("</td>");
      out.write("<td style=\"background-color:black;font-style:italic\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${nextScheduledRun}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td style=\"background-color:black\" colspan=\"3\">");
      out.write("&nbsp;");
      out.write("</td>");
      out.write("</tr>");

    }
  

    for (GenerationRunnerState generationState : periodicRunner.getState().getGenerationStates()) {
      pageContext.setAttribute("generationState", generationState);
      pageContext.setAttribute("statusHexColor", getHexColor(generationState.getStatus()));
      pageContext.setAttribute("formattedStartDateTime", formatShort(generationState.getStartTime()));
      pageContext.setAttribute("formattedEndDateTime", formatShort(generationState.getEndTime()));
  
      out.write("<tr>");
      out.write("<td style=\"background-color:black;text-align:left\">");
      out.write("<strong>");
      out.write("Generation ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${generationState.generationID}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</strong>");
      out.write(" &middot; ");
      out.write("<a target=\"_blank\" href=\"/log.txt\">");
      out.write("Logs");
      out.write("</a>");

        if (generationState.isRunning()) {
      
      out.write("\n      &middot;\n      ");
      out.write("<form style=\"display:inline\" method=\"POST\" action=\"/periodicRunner/interrupt\" name=\"periodicRunnerInterrupt\">");
      out.write("<a href=\"javascript:confirmAndPost('periodicRunnerInterrupt')\">");
      out.write("Interrupt");
      out.write("</a>");
      out.write("</form>");

        }
      
      out.write("</td>");
      out.write("<td style=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("background-color:black;text-align:center;color:${statusHexColor}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, true) + "\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${generationState.status}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td style=\"background-color:black\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${formattedStartDateTime}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td style=\"background-color:black\" colspan=\"2\">");
      out.write("&nbsp;");
      out.write("</td>");
      out.write("<td style=\"background-color:black\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${formattedEndDateTime}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("</tr>");

    for (StepState stepState : generationState.getStepStates()) {
      pageContext.setAttribute("statusHexColor", getHexColor(stepState.getStatus()));
      pageContext.setAttribute("stepState", stepState);
      pageContext.setAttribute("formattedStartDateTime", formatShort(stepState.getStartTime()));
      pageContext.setAttribute("formattedEndDateTime", formatShort(stepState.getEndTime()));
      pageContext.setAttribute("mapProgress", formatPercent(stepState.getMapProgress()));
      pageContext.setAttribute("reduceProgress", formatPercent(stepState.getReduceProgress()));
      String stepStateName = stepState.getName();
      pageContext.setAttribute("stepStateName", stepStateName);
  
      out.write("<tr>");
      out.write("<td>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${stepState.name}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td style=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("text-align:center;color:${statusHexColor}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, true) + "\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${stepState.status}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${formattedStartDateTime}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("<td class=\"meter\">");
      out.write("<span style=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("width:${mapProgress}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, true) + "\">");
      out.write("&nbsp;");
      out.write("</span>");
      out.write("</td>");
      out.write("<td class=\"meter\">");
      out.write("<span style=\"" + (java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("width:${reduceProgress}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, true) + "\">");
      out.write("&nbsp;");
      out.write("</span>");
      out.write("</td>");
      out.write("<td>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${formattedEndDateTime}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</td>");
      out.write("</tr>");

      }
    }
  
      out.write("</table>");
      out.write("<p>");
      out.write("&copy; Cloudera, Inc., except for included third-party open source software.");
      out.write("</p>");
      out.write("</div>");
      out.write("</body>");
      out.write("</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
